REM STAR TRIP V0.3 BY LAYER8
REM DATAINIT
REM POSITION
DIM P#(2,2)
REM SPEED
DIM M#(2)
REM GRAVITY
DIM G#(2)
REM SINCOS TABLE
DIM S#(360)
DIM C#(360)
REM SHIP SHAPE VECTOR DATA
DIM A(100)
DIM D(2,100)
W=0
V=0
REM STAR
DIM T(100)
REM ENEMY
DIM E(16)
DIM Y(8)
REM LASER
DIM L#(4)
X=-1
N=0
REM ANGLE
Z=90
REM FUEL
U=1500
REM STAGE
Q=1
REM RESULT
R=0

REM INIT
 RESTORE ADATA
 FOR I=0 TO 100
  A(I)=READ()-7
  IF A(I) = -7 THEN BREAK
 NEXT
 W=I-1
 FOR I=0 TO 359
  S#(I)=SIN#(FLOAT#(I)*PI#/180)
  C#(I)=COS#(FLOAT#(I)*PI#/180)
 NEXT
 FOR J=0 TO W
  T(J) = RND()%200
 NEXT
 INTERRUPT DRAWCOUNT,LZRINT

REM MAINLOOP
WHILE 1
 GOSUB PTINIT
 WHILE R=0
  GOSUB PTSTAR
  GOSUB GRAVTY
  GOSUB MVSHIP
  GOSUB PTFUEL
  GOSUB PTSHIP
  GOSUB PTLZR
  GOSUB HITCHK
  V=1-V
 WEND
WEND

LABEL PTINIT
 CLS
 WIDTH 40,2
 GPRINT 40,80,7,0,"STAR TRIP v0.3"
 IF Q<7 THEN
  GPRINT 60,90,7,0,"STAGE : "+DEC$(Q)
 ELSE
  Q=1
  GPRINT 0,90,7,0,"CLEAR : CONGRATULATIONS"
 ENDIF
 GPRINT 24,110,7,0,"PUSH START BUTTON"
 WHILE KEYS(16)=0:WAIT 1:I=RND():WEND
 GOSUB ENMDAT
 FOR I=0 TO 1
  P#(I,0)=20.0:P#(I,1)=100.0
  M#(I)=0.0
  G#(I)=0.0
 NEXT
 FOR I=0 TO 7
  Y(I)=1
 NEXT
 R=0
 U=1500
 CLS
 RETURN

LABEL ENMDAT
 FOR I=2 TO 15
  E(I)=RND()%160
  IF E(I) > 90 THEN E(I)=E(I)+20
 NEXT
 E(0)=100:E(1)=100:Y(0)=1
 RETURN

LABEL GRAVTY
 G#(0)=G#(0)+(100-P#(V,0))*0.00000001*(100-FABS#(100-P#(V,0)))*(100-FABS#(100-P#(V,0)))
 G#(1)=G#(1)-(100-P#(V,1))*0.00000001*(100-FABS#(100-P#(V,1)))*(100-FABS#(100-P#(V,1)))

 RETURN

LABEL MVSHIP
 K=KEYS()
 IF K=8 THEN Z=(Z+359)%360
 IF K=4 THEN Z=(Z+1)%360
 IF K=1 AND U > 0 THEN
  M#(0)=M#(0)+C#(Z)*0.001
  M#(1)=M#(1)+S#(Z)*0.001
  U=U-1
 ENDIF
 IF K=16 AND X=-1 THEN
  X=Z
  N=1
  L#(0)=P#(V,0):  L#(2)=P#(V,0)
  L#(1)=P#(V,1):  L#(3)=P#(V,1)
 ENDIF
 IF K=32 THEN
  R=2
  RETURN
 ENDIF

 P#(V,0)= P#(V,0) + M#(0) + G#(0)
 P#(V,1)= P#(V,1) - M#(1) + G#(1)
 FOR I=0 TO 1
  IF P#(V,I) < 0 THEN P#(V,I) = 199
  IF P#(V,I) > 199 THEN P#(V,I) = 0
 NEXT
 RETURN

LABEL PTSTAR
 FOR I = 0 TO W
  PSET T(I),T(I+1),1
  I = I+1
 NEXT
 GPRINT 100,100,7, 0, "*"
 FOR I = 1 TO Q
  IF Y(I)=1 THEN GPRINT E(I*2),E(I*2+1),7, 0, "+" ELSE GPRINT E(I*2),E(I*2+1),7, 0, " " 
 NEXT
 RETURN

LABEL PTFUEL
 BOXFILL 40,180,160,185,15
 IF U > 500 THEN BOXFILL 50,181,U/15 + 50,183,4
 IF U > 0 THEN BOXFILL 50,181,U/15 + 50,183,2
 RETURN

LABEL PTSHIP
  FOR J = 0 TO W
   D(V,J) = INT(FLOAT#(A(J)) * C#((Z+270)%360) + FLOAT#(A(J+1)) * S#((Z+270)%360))
   D(V,J+1) = INT(FLOAT#(0 - A(J)) * S#((Z+270)%360) + FLOAT#(A(J+1)) * C#((Z+270)%360))
   PSET D(1-V,J)+INT(P#(1-V,0)), D(1-V,J+1)+INT(P#(1-V,1)), 0
   PSET D(V, J)+INT(P#(V,0)), D(V,J+1)+INT(P#(V,1)), 7
   J=J+1
  NEXT
 RETURN

LABEL PTLZR
 IF N=0 THEN RETURN
 PSET INT(L#(2)), INT(L#(3)),7
 PSET INT(L#(0)), INT(L#(1)),0
 L#(0)=L#(2)
 L#(1)=L#(3)
 IF X!= -1 THEN N=0 ELSE PSET INT(L#(2)), INT(L#(3)),0

 RETURN

LABEL LZRINT
 IF N=1 THEN RETURN

 N=1
 L#(2)=L#(0)+C#(X)*3: L#(3)=L#(1)-S#(X)*3
 IF L#(2) < 1 OR L#(2) > 199 OR L#(3) < 1 OR L#(3) > 199 THEN
  X=-1
  RETURN
 ENDIF
 RETURN

LABEL HITCHK
 J=0
 FOR I=0 TO Q
  IF Y(I) != 0 THEN
   J=J+1
   IF ((E(I*2)-4) < INT(P#(V,0)) AND (E(I*2)+12) > INT(P#(V,0))) AND ((E(I*2+1)-4) < INT(P#(V,1)) AND (E(I*2+1)+12) > INT(P#(V,1))) THEN
    R=2
   ENDIF
   IF I>0 AND ((E(I*2)-4) < INT(L#(2))) AND ((E(I*2)+12) > INT(L#(2))) AND ((E(I*2+1)-4) < INT(L#(3))) AND ((E(I*2+1)+12) > INT(L#(3))) THEN
    Y(I)=0
   ENDIF
  ENDIF
 NEXT
 IF J=1 THEN 
  R=1
  Q=Q+1
 ENDIF
 IF R=2 THEN
  FOR I=5 TO 10
   CIRCLE INT(P#(V,0)), INT(P#(V,1)), I, 7
   WAIT 1
  NEXT
 WAIT 60
 ENDIF

 RETURN

LABEL ADATA
DATA 7,1,7,2,6,3,8,3,6,4,8,4,5,5,9,5,5,6,9,6,5,7,9,7,5,8,9,8,5,9,9,9,5,10,9,10,5,11,9,11,5,12,9,12,5,13,9,13,4,11,5,11,9,11,10,11,3,12,11,12,4,12,10,12,3,13,5,13,7,13,9,13,10,13,11,13,0,0
